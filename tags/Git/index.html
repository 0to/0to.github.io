
<!DOCTYPE html>
<html lang="en,zh-cn,default">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Just Do IT">
    <title>Tag: Git - Just Do IT</title>
    <meta name="author" content="Weilong">
    
    
        <link rel="icon" href="https://0to.github.io/assets/images/owl.png">
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="小弟读过两年书，尘世中一个迷途小书童。">
<meta property="og:type" content="blog">
<meta property="og:title" content="Just Do IT">
<meta property="og:url" content="https://0to.github.io/tags/Git/index.html">
<meta property="og:site_name" content="Just Do IT">
<meta property="og:description" content="小弟读过两年书，尘世中一个迷途小书童。">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Weilong">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://0to.github.io/assets/images/owl.png"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-85893233-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-85893233-1');
    </script>


    
    <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?c9c4d3aced97237b37b08c97b10e7d3e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Just Do IT
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/owl.png" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/owl.png" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Weilong</h4>
                
                    <h5 class="sidebar-profile-bio"> <ul> Write something about work and life: <ul class="nav pull-left"> <li align="left">Project management</li> <li align="left">Configuration management</li> <li align="left">Process improvement</li> <li align="left">Continuous deploy</li> <li align="left">Python program</li> </ul>
</ul> </h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/0to"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://cn.linkedin.com/in/龙-威-73303298"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:326688025@qq.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/posts/22197/"
                            aria-label=": Centos7 升级git版本 - 源码编译安装"
                        >
                            Centos7 升级git版本 - 源码编译安装
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-10-13T14:30:06+08:00">
	
		    Oct 13, 2020
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/SCM/">SCM</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>原生Centos7系统的yum源自带git版本是1.8.3.1。</p>
<p>这个版本诞生于：10-Jun-2013。</p>
<p>很多新特性都不支持，为了更好的使用git，我们需要进行版本升级。</p>
<h1 id="源码编译安装"><a href="#源码编译安装" class="headerlink" title="源码编译安装"></a>源码编译安装</h1><ol>
<li>安装相关依赖<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc</span><br><span class="line"># yum install  gcc perl-ExtUtils-MakeMaker</span><br></pre></td></tr></table></figure></li>
<li>卸载当前git<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum remove git</span><br></pre></td></tr></table></figure></li>
<li>下载新版本源码包<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">官方仓库地址：https://mirrors.edge.kernel.org/pub/software/scm/git/</span><br><span class="line">当前最新版本：git-2.28.0.tar.xz       27-Jul-2020</span><br><span class="line"></span><br><span class="line"># wget https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.28.0.tar.xz</span><br></pre></td></tr></table></figure></li>
<li>源码编译安装<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># tar -xvf git-2.28.0.tar.xz</span><br><span class="line"># cd git-2.28.0/</span><br><span class="line"># which openssl  获取本机openssl路径，当前机器/usr/bin/openssl</span><br><span class="line"># ./configure --with-openssl=/usr/bin/openssl</span><br><span class="line"># make prefix=/usr/local/git all</span><br><span class="line"># make prefix=/usr/local/git install</span><br><span class="line"># echo &quot;export PATH=$PATH:/usr/local/git/bin&quot; &gt;&gt; /etc/profile</span><br><span class="line"># source /etc/profile</span><br></pre></td></tr></table></figure></li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/posts/22197/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/posts/31267/"
                            aria-label=": Git tips two"
                        >
                            Git tips two
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-09-23T18:51:04+08:00">
	
		    Sep 23, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/SCM/">SCM</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="软件版本："><a href="#软件版本：" class="headerlink" title="软件版本："></a>软件版本：</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git version 2.23.0</span><br></pre></td></tr></table></figure>

<h2 id="使用http-https协议代码库地址，有时会出现不能存储密码，每次交互操作都需要输入帐户密码情况："><a href="#使用http-https协议代码库地址，有时会出现不能存储密码，每次交互操作都需要输入帐户密码情况：" class="headerlink" title="使用http/https协议代码库地址，有时会出现不能存储密码，每次交互操作都需要输入帐户密码情况："></a>使用http/https协议代码库地址，有时会出现不能存储密码，每次交互操作都需要输入帐户密码情况：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">记住密码（默认15分钟）：git config --global credential.helper cache</span><br><span class="line">自己定义时间（一小时后失效）：git config credential.helper &#x27;cache --timeout=3600&#x27;</span><br><span class="line">永久存储密码：git config --global credential.helper store</span><br></pre></td></tr></table></figure>

<h2 id="行结束符处理："><a href="#行结束符处理：" class="headerlink" title="行结束符处理："></a>行结束符处理：</h2><table>
<thead>
<tr>
<th>OS</th>
<th align="center">Line Endings</th>
<th align="right">Comments</th>
</tr>
</thead>
<tbody><tr>
<td>Windows</td>
<td align="center">CRLF</td>
<td align="right">每行结尾是 &lt;换行&gt;&lt;回车 &gt; ，即 \n\r</td>
</tr>
<tr>
<td>Mac OS X</td>
<td align="center">LF</td>
<td align="right">每行结尾只有 &lt;换行&gt; ，即 \n</td>
</tr>
<tr>
<td>Unix/Linux</td>
<td align="center">LF</td>
<td align="right">每行结尾只有 &lt;换行&gt; ，即 \n</td>
</tr>
<tr>
<td>Classic macOS</td>
<td align="center">CR</td>
<td align="right">每行结尾是 &lt;回车&gt;，即 \r</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">排除老Mac系统不讨论，项目组如果不是全Windows环境开发/部署的话，还是要自动处理下行结束符。</span><br><span class="line"></span><br><span class="line"># Windows用户执行下面配置命令：</span><br><span class="line">$ git config --global core.autocrlf true # 在提交时自动地把行结束符CRLF转换成LF，而在签出代码时把LF转换成CRLF</span><br><span class="line"></span><br><span class="line"># Linux 和 Mac用户执行下面配置命令：（预防代码库已经有CRLF结束符的代码）</span><br><span class="line">$ git config --global core.autocrlf input # 在提交时把CRLF转换成LF，签出时不转换</span><br><span class="line"></span><br><span class="line"># 默认配置：</span><br><span class="line">$ git config --global core.autocrlf false # 提交和签出时都不对代码行结束符做转换</span><br><span class="line"></span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/posts/31267/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/posts/1056/"
                            aria-label=": Git 历史删除文件"
                        >
                            Git 历史删除文件
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2018-07-18T15:23:19+08:00">
	
		    Jul 18, 2018
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/SCM/">SCM</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h1><ul>
<li>Github: <a target="_blank" rel="noopener" href="https://help.github.com/articles/removing-files-from-a-repository-s-history/">Removing files from a repository’s history</a></li>
<li>Github: <a target="_blank" rel="noopener" href="https://help.github.com/articles/removing-sensitive-data-from-a-repository/">Removing sensitive data from a repository
</a></li>
<li>Git-scm: <a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-filter-branch">git-filter-branch</a></li>
<li>bfg-repo-cleaner: <a target="_blank" rel="noopener" href="https://rtyley.github.io/bfg-repo-cleaner/">bfg-repo-cleaner</a></li>
</ul>
<hr>
<h1 id="场景1"><a href="#场景1" class="headerlink" title="场景1:"></a>场景1:</h1><p>最新的一个提交版本里面新增了敏感、较大、无意义的文件，需要进行清理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. 删除文件</span><br><span class="line">    $ git rm --cached $&#123;文件绝对地址&#125;</span><br><span class="line">2. 增加到上述文件到 .gitignore</span><br><span class="line">    $ vim .gitignore</span><br><span class="line">3. 修复最新提交版本</span><br><span class="line">    $ git commit --amend</span><br><span class="line">4. 推送新版本到远端仓库</span><br><span class="line">    如果刚才版本已经推送到远端仓库：</span><br><span class="line">        $ git push -f</span><br><span class="line">    如果刚才版本只是在本地仓库：</span><br><span class="line">        $ git push</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="场景2"><a href="#场景2" class="headerlink" title="场景2:"></a>场景2:</h1><p>历史版本里面存在敏感、较大、无意义的文件，需要进行清理。</p>
<h3 id="使用-git-filter-branch"><a href="#使用-git-filter-branch" class="headerlink" title="使用 git filter-branch"></a>使用 git filter-branch</h3><p>git 原生提供的命令，如果没有的话，请先升级机器git版本。</p>
<ul>
<li>原理：<br>  扫描代码库所有版本<pre><code>  如果某个版本里面发现了指定的文件OR目录：
      如果此版本包含要清理的文件OR目录 和 其它变更的话，对此版本进行删除指定文件OR目录（保留其它变更），并生成新的版本。同时后面的版本会变基到新版本。
      如果此版本只包含要清理的文件OR目录变更的话，那么此版本会被清除。同时后面的版本会变基到上一个版本。
  如果版本没有包含指定文件OR目录，那么继续遍历。
</code></pre>
</li>
<li>PS：<ol>
<li>如果代码库历史比较多 OR 涉及到指定文件OR目录的版本比较多，那么命令执行会比较慢。</li>
<li>一般会导致代码库版本树变化，对于涉及开发同学，建议开始前提交本地修改变更到远端仓库，完成后本机重新clone代码库进行开发。</li>
<li>一般都在本地仓库根目录执行</li>
<li>执行命令后历史版本里面已经清理了文件, 但是我们的本地仓库里面仍然保留了这些objects, 等待垃圾回收(GC), 如果想立即回收本地仓库空间可以执行 git gc –prune=now.</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. 执行命令</span><br><span class="line">    $ git filter-branch --force --index-filter &#x27;git rm --cached -r --ignore-unmatch $&#123;要清理的文件OR目录的绝对地址&#125;&#x27; --prune-empty --tag-name-filter cat -- --all</span><br><span class="line">2. 增加到上述文件OR目录到 .gitignore</span><br><span class="line">    $ vim .gitignore</span><br><span class="line">3. 推送新版本到远端仓库</span><br><span class="line">    $ git push -f --all</span><br><span class="line">    $ git push -f --tags</span><br><span class="line">4. 清理本地仓库残留的git objects</span><br><span class="line">    $ git reflog expire --expire=now --all</span><br><span class="line">    $ git gc --prune=now</span><br></pre></td></tr></table></figure>



<h3 id="使用-bfg-repo-cleaner"><a href="#使用-bfg-repo-cleaner" class="headerlink" title="使用 bfg-repo-cleaner"></a>使用 bfg-repo-cleaner</h3><p>Roberto Tyley使用Scala语言写了 bfg-repo-cleaner工具。<br>可以简单理解为一个轻量级的 git filter-branch。<br>使用比较简单，功能比较强大，只需要下载最新的jar包，然后执行👇命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 删除大于50M的文件</span><br><span class="line">$ java -jar bfg.jar --no-blob-protection --strip-blobs-bigger-than 50M</span><br><span class="line"># 删除指定文件</span><br><span class="line">$ java -jar bfg.jar --no-blob-protection --delete-files $&#123;要清理的文件的绝对地址&#125;</span><br></pre></td></tr></table></figure>
<p>PS:<br>    1. bfg-repo-cleaner 有个protect功能，默认HEAD是受保护的。<br>        受保护的分支最新版本如果涉及需要清理文件，那么并不会成功。<br>        –no-blob-protection  关闭protect功能<br>        –protect-blobs-from ${分支1},${分支2} 增加受保护的分支<br>    2. 建议在本地仓库根目录执行。</p>
<hr>
<h1 id="场景3"><a href="#场景3" class="headerlink" title="场景3:"></a>场景3:</h1><p>查找代码库里面较大文件方法：<br>    - 如果当前版本还存在的文件，可以直接du排序来识别；<br>    - 如果当前版本不存在，但是历史中出现过的大文件，可以按照下面步骤来查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 显示比较大的pack</span><br><span class="line">$ du -ah .git/objects/pack</span><br></pre></td></tr></table></figure>
<p><img src="/posts/1056/git1.png" alt="logo"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2. 识别object,对输出的第三列信息即文件大小进行排序</span><br><span class="line">$ git verify-pack -v .git/objects/pack/$&#123;pack-XXX.pack&#125; | sort -k 3 -n | tail -5</span><br></pre></td></tr></table></figure>
<p><img src="/posts/1056/git2.png" alt="logo"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3. 识别object对应的文件</span><br><span class="line">$ git rev-list --objects --all | grep $&#123;👆获取的object&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/posts/1056/git3.png" alt="logo"></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/posts/1056/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/posts/62558/"
                            aria-label=": svn代码库迁移到git"
                        >
                            svn代码库迁移到git
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2018-03-07T10:30:04+08:00">
	
		    Mar 07, 2018
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/SCM/">SCM</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="背景："><a href="#背景：" class="headerlink" title="背景："></a>背景：</h1><p>公司主要使用git作为代码管理仓库，现需要把部分使用svn管理的代码迁移到git。</p>
<h3 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h3><p>需要保留所有 branches、主干、tags的历史记录。</p>
<h1 id="迁移方法："><a href="#迁移方法：" class="headerlink" title="迁移方法："></a>迁移方法：</h1><p>使用git官方提供的git svn命令</p>
<ul>
<li>参考链接：<a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-svn">官方文档</a></li>
</ul>
<h3 id="系统环境："><a href="#系统环境：" class="headerlink" title="系统环境："></a>系统环境：</h3><ul>
<li>OS: macOS 10.13.3</li>
<li>SVN：1.9.4</li>
<li>GIT：2.16.2</li>
</ul>
<h1 id="迁移步骤："><a href="#迁移步骤：" class="headerlink" title="迁移步骤："></a>迁移步骤：</h1><ol>
<li>获取指定svn代码库涉及的开发同学名单并转换：<pre><code> svn log $SVN_URL --xml | grep author | sort -u | perl -pe &#39;s/.*&gt;(.*?)&lt;.*/$1 = /&#39; &gt; user.txt
</code></pre>
user.txt内容如下：<pre><code> dev1_name =
 dev2_name =
</code></pre>
因为svn只有用户名，而git需要提供用户名和邮箱，所以我们需要做下用户转换。<pre><code> 修改上述命令得到的user.txt如下：
 dev1_name = dev1_name&lt;dev1_email&gt;
 dev2_name = dev2_name&lt;dev2_email&gt;
</code></pre>
</li>
<li>使用git svn cloned代码库到本地：<pre><code> git svn clone $SVN_URL --no-metadata --authors-file=user.txt -s
</code></pre>
</li>
<li>调整本地库目录结构：<pre><code> cd $project_dir
 mv .git/refs/remotes/origin/tags/$tags_name .git/refs/tags/
 mv .git/refs/remotes/origin/$branches_name .git/refs/heads/
 rm -rf .git/refs/remotes/origin
</code></pre>
</li>
<li>上传本地库到remote仓库：<pre><code> git remote add origin $GIT_URL
 git push origin --all
 git push origin --tags
</code></pre>
</li>
</ol>
<h3 id="PS"><a href="#PS" class="headerlink" title="PS:"></a>PS:</h3><ol>
<li>如果svn历史记录太多，而且并不需要很久之前的版本的话，可以选择从指定版本进行转换。<pre><code> git svn clone $SVN_URL -r $指定版本:HEAD
</code></pre>
</li>
<li>较新版本的git都原生带了 git svn命令，如果你使用的git版本没有此命令，建议升级新版git或者单独安装git-svn命令。</li>
<li>git clone命令执行时间主要和 原SVN库大小、log多少有关。</li>
<li>svn迁移git后需要注意git不支持空目录，需要使用在空目录增加隐藏文件来上传，通常使用.gitkeep文件。</li>
<li>如果原SVN库结构不是规范的branches、tags、trunk结构<pre><code> git svn clone $SVN_URL --branches=&lt;branches_subdir&gt; --tags=&lt;tags_subdir&gt; --trunk=&lt;trunk_subdir&gt;
 如果没有tags的话--tags可以不写，branches同理；subdir写相对路径即可
</code></pre>
 上面使用的-s参数表示的是–stdlayout适合标准结构的SVN项目。</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/posts/62558/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/posts/52695/"
                            aria-label=": 分支策略"
                        >
                            分支策略
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-04-25T19:37:40+08:00">
	
		    Apr 25, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/SCM/">SCM</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="背景："><a href="#背景：" class="headerlink" title="背景："></a>背景：</h1><blockquote>
<p>为了更好的支持产品研发过程，我们需要设计符合公司研发的分支策略。<br>无论多复杂或者简单的策略都可以归类为以下两种：</p>
<blockquote>
<p>1.主干开发，分支发布<br>2.分支开发，主干发布</p>
</blockquote>
</blockquote>
<blockquote>
<p>PS：我们约定：</p>
<blockquote>
<p>主干（master/git  trunk/svn）<br>    分支（branch）<br>    标签（tag）<br>如果从版本控制工具实现上来看：<br>        svn： trunk、branch、tag 没有差别<br>        git： master、branch、轻量级tag 没有差别<br>        为了更好的区分和管理，人为的从逻辑上进行区分<br>        tag的作用：里程碑记录，方便回溯（发布回滚等）</p>
</blockquote>
</blockquote>
<h1 id="主干开发，分支发布："><a href="#主干开发，分支发布：" class="headerlink" title="主干开发，分支发布："></a>主干开发，分支发布：</h1><p><img src="/posts/52695/zhugan.png" alt="logo"></p>
<ul>
<li>优点：<ol>
<li>较少的分支存在，大家专注在主干开发</li>
</ol>
</li>
<li>适用于：<ol>
<li>敏捷开发模式，每个迭代都很快</li>
<li>维护型项目，较少需求变更，基本没有并行开发的需要</li>
<li>个人项目</li>
</ol>
</li>
<li>常用方式：<ol>
<li>所有dev在主干上面进行开发</li>
<li>需要发布的时候从指定版本拉出发布分支，进行测试<ul>
<li>如果成功：那么打出tag，进行发布</li>
<li>如果不成功：那么继续在发布分支上面进行修改，然后测试；<br>  测试成功后，打tag，合并发布分支修改到主干；</li>
</ul>
</li>
</ol>
</li>
</ul>
<h1 id="分支开发，主干发布："><a href="#分支开发，主干发布：" class="headerlink" title="分支开发，主干发布："></a>分支开发，主干发布：</h1><p><img src="/posts/52695/fenzhi.png" alt="logo"></p>
<ul>
<li>优点：<ol>
<li>对并行开发支持很好</li>
</ol>
</li>
<li>适用于：<ol>
<li>并行开发很频繁的项目</li>
</ol>
</li>
<li>常用方式：<ol>
<li>根据项目发布排期拉出并行开发分支</li>
<li>不同or相同的dev分别在分支上面进行开发</li>
<li>测试通过后，打tag进行发布，合并分支修改到主干</li>
<li>后发布的分支需要合并最新的主干代码</li>
</ol>
</li>
<li>注意点：<ol>
<li>所有分支都从主干拉出；</li>
<li>发布时候要检查 tag是否包含最新的主干代码；</li>
<li>后发布的分支在合并最新主干代码后，注意测试范围扩大（除了测试本分支功能外，合并过来的功能也需要覆盖到！！！）</li>
</ol>
</li>
</ul>
<h1 id="PS："><a href="#PS：" class="headerlink" title="PS："></a>PS：</h1><p>本文只是简单介绍下基础的分支策略，各位需根据自身团队、业务来综合定制适合的分支策略。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/posts/52695/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/posts/60120/"
                            aria-label=": Git tips one"
                        >
                            Git tips one
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-03-31T14:40:12+08:00">
	
		    Mar 31, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/SCM/">SCM</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="软件版本："><a href="#软件版本：" class="headerlink" title="软件版本："></a>软件版本：</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git version 2.10.1</span><br></pre></td></tr></table></figure>

<h1 id="Git克隆单个分支："><a href="#Git克隆单个分支：" class="headerlink" title="Git克隆单个分支："></a>Git克隆单个分支：</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git clone 地址 —branch br1 —single-branch dir</span><br><span class="line">        只能看到单独的br1，不能checkout到其他分支。空间占用比较小，适合长期分支开发。</span><br><span class="line">原理：</span><br><span class="line">$ git remote -v</span><br><span class="line">        remote.origin.fetch=+refs/heads/br1:refs/remotes/origin/br1</span><br><span class="line">恢复完整代码库：</span><br><span class="line">$ git config remote.origin.fetch &quot;+refs/heads/*:refs/remotes/origin/*&quot;</span><br><span class="line">    然后执行</span><br><span class="line">    $ git pull</span><br></pre></td></tr></table></figure>

<h1 id="Git对-gitignore文件处理："><a href="#Git对-gitignore文件处理：" class="headerlink" title="Git对.gitignore文件处理："></a>Git对.gitignore文件处理：</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">已经增加到.gitignore文件里面的目录or文件会被git忽略。</span><br><span class="line">如果本次需要修改一个忽略文件：</span><br><span class="line">$ git status --ignored</span><br><span class="line">            --ignored   -- show ignored files as well</span><br><span class="line">$ git add -f</span><br><span class="line">            --force   -f   -- allow adding otherwise ignored files</span><br></pre></td></tr></table></figure>


<h1 id="Git-commit相关："><a href="#Git-commit相关：" class="headerlink" title="Git commit相关："></a>Git commit相关：</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 空提交,只在特殊情况下使用（产生一个新的commit点）</span><br><span class="line">$ git commit</span><br><span class="line">    On branch master</span><br><span class="line">    Your branch is up-to-date with &#x27;origin/master&#x27;.</span><br><span class="line">    nothing to commit, working tree clean</span><br><span class="line"># 解决方法</span><br><span class="line">$ git commit -m &quot;empty commit&quot; --allow-empty</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 不带message提交（慎用,message很重要）</span><br><span class="line">$ git commit</span><br><span class="line">    Aborting commit due to empty commit message.</span><br><span class="line"># 解决方法</span><br><span class="line">$ git commit --allow-empty-message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">把暂存区的变更合并到最新的版本里面，不会产生新的版本(同时可以更新log message)；</span><br><span class="line">$ git commit --amend</span><br><span class="line">PS：已经进远端代码库的版本不允许使用--amend进行修改!!!</span><br></pre></td></tr></table></figure>

<h2 id="Git-merge相关："><a href="#Git-merge相关：" class="headerlink" title="Git merge相关："></a>Git merge相关：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">conflict处理：</span><br><span class="line"># 使用自己/他人的文件替换冲突文件</span><br><span class="line">$ git checkout --ours conflict.file</span><br><span class="line">$ git checkout --theirs conflict.file</span><br><span class="line"># 增加冲突文件到版本库</span><br><span class="line">$ git add conflict.file</span><br><span class="line">$ git commit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看merge commit点已经解决的冲突文件：</span><br><span class="line">$ git log --cc</span><br><span class="line">        --cc    -- combined diff format for merge commits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">分支直接合并建议使用：git merge</span><br><span class="line">同一分支dev合并 or Temp分支合并建议使用：git rebase 或者 git cherry-pick</span><br><span class="line">    PS：以上两种都可以合并代码workspace最终文件一样，但是对git来说有不同：merge是环形，rebase和cherry-pick是直线</span><br><span class="line">    PS：需要注意的是rebase会是自己和他人角色发生反转，解决conflict file的时候需要留心。</span><br></pre></td></tr></table></figure>

<h2 id="Git-rm相关："><a href="#Git-rm相关：" class="headerlink" title="Git rm相关："></a>Git rm相关：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git rm weilong.txt</span><br><span class="line">删除workspace和index里面的weilong.txt文件</span><br><span class="line"></span><br><span class="line">$ git rm --cached weilong.txt</span><br><span class="line">删除index里面的weilong.txt文件，workspace里面的文件保留</span><br></pre></td></tr></table></figure>

<h2 id="Git-log相关："><a href="#Git-log相关：" class="headerlink" title="Git log相关："></a>Git log相关：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ git log -5</span><br><span class="line">查看最新的5次版本</span><br><span class="line"></span><br><span class="line">$ git log --author=weilong.wang</span><br><span class="line">查看weilong.wang提交的版本</span><br><span class="line"></span><br><span class="line">$ git log --oneline</span><br><span class="line">一行显示一个版本信息（简化显示版本信息）</span><br><span class="line"></span><br><span class="line">$ git log -p</span><br><span class="line">显示每个版本的具体修改</span><br><span class="line"></span><br><span class="line">$ git log --numstat</span><br><span class="line">显示每个版本 修改文件的行数（5       1       weilong.txt    这个文件本次增加了5行同时也删除了1行）</span><br><span class="line"></span><br><span class="line">$ git log --since=&quot;1 month ago&quot;</span><br><span class="line">显示最近一个月的日志</span><br><span class="line">$ git log --after=&quot;2016-07-01&quot;</span><br><span class="line">显示7月1号至今的日志</span><br><span class="line">$ git log --before=&quot;2 days&quot;</span><br><span class="line">显示2天之前的日志</span><br><span class="line">$ git log --until=&quot;2016-07-10T14:30&quot;</span><br><span class="line">显示7月10号14：30之前的日志</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ git log --graph</span><br><span class="line">图状显示版本 （正常提交时线形的，merge是环形的）</span><br><span class="line"></span><br><span class="line">可用于判断分支是否合并：</span><br><span class="line">$ git log br1 ^master</span><br><span class="line">显示只在分支br1不在master上的commit点</span><br><span class="line">$ git log master ^br1</span><br><span class="line">显示只在分支master不在br1分支上的commit点</span><br></pre></td></tr></table></figure>

<p><img src="/posts/60120/Git-Cheat-Sheet.png" alt="logo"></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/posts/60120/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 Weilong. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/owl.png" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Weilong</h4>
        
            <div id="about-card-bio"> <ul> Write something about work and life: <ul class="nav pull-left"> <li align="left">Project management</li> <li align="left">Configuration management</li> <li align="left">Process improvement</li> <li align="left">Continuous deploy</li> <li align="left">Python program</li> </ul>
</ul> </div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>PM</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Shenzhen
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
